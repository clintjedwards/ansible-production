- name: Nomad Minion | Create user
  user:
    name: "nomad"
    createhome: no
    append: yes

- name: Nomad Minion | Create /etc/nomad/data folder
  file:
    path: /etc/nomad/data
    state: directory
    owner: nomad
    group: nomad
    recurse: yes

- name: Nomad Minion | Create /etc/nomad/nomad.d folder
  file:
    path: /etc/nomad/nomad.d
    state: directory
    owner: nomad
    group: nomad
    recurse: yes

- name: Nomad Minion | Download, unzip, and install binary
  unarchive:
    src: https://releases.hashicorp.com/nomad/{{nomad_version}}/nomad_{{nomad_version}}_linux_arm.zip
    dest: /usr/bin
    remote_src: yes
    validate_certs: yes
    creates: /usr/bin/nomad
    mode: 0755

- name: Nomad Minion | Set systemd file
  copy:
    src: nomad.service
    dest: /etc/systemd/system/nomad.service

- name: Nomad Minion | Reload systemd for new service file
  systemd:
    daemon_reload: yes

- name: Nomad Minion | Enable service in systemd
  systemd:
    name: nomad
    enabled: yes

- name: Nomad Minion | Copy config files
  copy:
    src: nomad.config.hcl
    dest: /etc/nomad/nomad.config.hcl
    owner: nomad
    group: nomad
